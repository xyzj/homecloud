# Caddy's configuration file
# see: https://caddyserver.com/docs/caddyfile

(common_headers) {
  encode gzip
}
(tls_conf) {
  tls /root/bin/ca/xyzjdays.xyz.crt /root/bin/ca/xyzjdays.xyz.key
}
(log_conf) {
  log {
    output file "/var/log/caddy.log" {
      roll_size 10mb
      roll_keep 1
      roll_keep_for 3d
    }
  }
}
http://v2cf.xyzjdays.xyz, http://v4.xyzjdays.xyz, http://xyzjdays.xyz {
    redir https://{host}{uri}
}

v2cf.xyzjdays.xyz {
#  import common_headers
  import tls_conf
#  import log_conf
  @v2ray_ws {
      path /xx
      header Connection Upgrade
      header Upgrade websocket
  }
  reverse_proxy @v2ray_ws 127.0.0.1:6891
}
v4.xyzjdays.xyz {
#  import common_headers
#  import log_conf
  import tls_conf
  reverse_proxy http://127.0.0.1:2052
}

xyzjdays.xyz {
#  import common_headers
#  import log_conf
  import tls_conf
  redir https://v4.xyzjdays.xyz/short{uri} 302
}
